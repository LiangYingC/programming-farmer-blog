---
title: 淺談前端錯誤發生時的處理與監控機制
date: 2023-09-30
description: 在 Production 運行的軟體服務，如果在錯誤發生時，有良好的處理與監控的機制，就能更快速地查找問題並且修復完成，藉此讓使用者受到困擾的時間下降、體驗更佳。軟體中的錯誤處理範圍涵蓋很大，本文主要是分享關於「錯誤發生時，前端有什麼基本的機制去處理」，包含「錯誤畫面的顯示(UI)」、「錯誤資訊的記錄(Log)」、「錯誤警告的通知(Alert)」等。
tag: frontend, react, javaScript, gcp
---

## 前言

在軟體專案中，錯誤處理是很重要的一塊，涵蓋範圍非常廣，且針對不同的產品性質也會有不同的錯誤處理和監控方式。在本文中，分享的是「前端相關的錯誤處理和監控」，而且會偏向「通用型」的整體概念和實作，不論哪類型的產品都有機會應用。

會撰寫本文記錄和分享，主要是因為近幾個月在工作專案中，有和工作夥伴試著把前端處理錯誤的部分進行優化，包含錯誤 UI 、錯誤記錄、錯誤監控等項目，藉此讓「**錯誤發生時**」使用者體驗更好，以及能更快地查找問題資訊藉此修復問題。因此想藉此機會把梳理前端錯誤處理的概覽，並順道分享，讓有需要的人可以參考。

這邊有特別標註「錯誤發生時」，是因本文不會提到「錯誤發生前的預防」、「錯誤發生後的檢討」，而是分享關於「錯誤發生時，可以怎麼系統性地看待和處理」。

更具體來說，想達成的目標是：「**讓使用者遭遇到錯誤時，受到困擾的時間下降、體驗的感受不會更差**」，延伸來說有幾個問題是重要的：

- 如何能讓使用者遇到錯誤後，在畫面上的體驗是不差的？
- 如何能讓使用者遇到錯誤後，僅提供錯誤畫面截圖，團隊就能處理好問題？
- 如何能在發生錯誤時，會收到警告通知，藉此在使用者還沒主動反應前，團隊就能開始著手處理？

接下來的內文將討論上述問題，以及試著解決之。

而文章主要會分成三個大段落，分別是「概念架構面」、「實作程式面」與「做完後實際對產品的幫助」。

在**概念架構**的部分，主要會分享對於錯誤處理與監控的全貌，這部分的內容，無論是用什麼語言框架撰寫的產品都能有所學習和應用，期望閱讀後，對前端錯誤處理和監控的全貌有所認識，對概念架構有所認識後，才會進入到實作部分。

在**實作程式**的部分，主要會分享透過 Next.js、GCP Logging / Monitoring，簡要地實踐概念架構篇中談的內容。順帶一提，網頁中的錯誤類型很多，這邊不會多做介紹，實作的部分會直接以「React Error Boundary」抓到的 Unexpected Error 作為示範囉，但實作概念都是可以套用到不同錯誤類型，期望閱讀後，能知道怎麼實際處理前端錯誤監控。

在上述兩個段落都分享後，也會稍微分享實際上實作在產品後，究竟對於團隊有哪些幫助。

是說關於“淺談”的標題，是因為我寫一寫後，覺得內容偏淺，於是決定加上“淺談”，希望不會造成太大的期待落差，個人認為學習完這篇後，比較是對擴展前端的廣度，但技術深度不高。如果就產品層面來看，原本沒有前端錯誤處理和監控的產品加上相關功能後，的確有機會能提高除錯效率。

總之，期望閱讀完後能夠：

理解基本的前端錯誤處理機制全貌，並有明確方向能實作之。

---

## 從概念架構面，談前端錯誤處理與監控

先回顧前言中提到的三個問題：

1. 如何能讓使用者遇到錯誤後，在畫面上的體驗是不差的？
2. 如何能讓使用者遇到錯誤後，僅提供錯誤畫面截圖，團隊就能處理好問題？
3. 如何能在發生錯誤時，會收到警告通知，藉此在使用者還沒主動反應前，團隊就能開始著手處理？

這些算是活下來的軟體產品早晚需要面對的問題。

問題 1 與 2 有提到一個共同點是關於「**顯示錯誤發生時的畫面**」，好的錯誤畫面設計，除了能讓使用者緩緩遇到錯誤時的情緒或知道下一步能怎麼做外，還可以提供合適的資訊，像是錯誤時間、標題、描述等，藉此讓團隊解決問題的速度更快。

而如何能只透過錯誤畫面的資訊，或有時候甚至連錯誤畫面都沒有，僅提供錯誤發生的大概時間，就有辦法查到詳細的錯誤訊息呢？

那就需要在錯誤發生時，「**記錄錯誤的詳細資訊在某個地方**」，藉此就能透過錯誤發生時間查找到詳細錯誤訊息，進一步去解決問題。

上面談的情境，都是基於使用者提供錯誤畫面截圖或錯誤發生時間後，開發者才開始查找錯誤細節與處理問題，但是否有機會在使用者主動反應前，更早地處理問題呢？

那就需要自動「**發送錯誤出現的警告通知**」。當錯誤發生時，透過發送訊息或信件，立刻通知開發者，就能讓開發者更快地去處理問題，也能預先通知產品經理，讓其知道接下來會面對使用者的抱怨是什麼，並提早做好應對方案。

到此針對解決問題的方向，大致做個分類：
 
1. **畫面層級**：當使用者遇到錯誤時，**需要顯示設計好的錯誤畫面**，除了能讓使用者體驗比較好外，畫面上也可以有部分資訊，藉此協助團隊更快地辨別問題或者進一步查找問題。
2. **記錄層級**：當使用者提供截圖畫面時，能夠從截圖中的錯誤標題、錯誤發生時間等等，延伸查詢到更多的錯誤細節，藉此幫助 debug 修復問題。因此就需要**把錯誤詳情送進記錄錯誤 Log 第三方服務中** (e.g. Sentry, GCP Logging)，只要有記錄存在，就能查詢到錯誤細節。
3. **監控層級**：當有錯誤發生送進第三方服務時，可以設置特定錯誤條件的警告，發送通知到 Slack、Email 等，**讓系統主動通知團隊有異常錯誤**，藉此儘早查看錯誤 Log 並處理之，無需等到使用者反應問題。這類警告機制，通常可以在第三方服務中 (e.g. Sentry, GCP Monitoring) 就能設定。

這三個層級是彼此分離的，可以獨自存在毋須一次擁有，真實情況下，團隊都有時間、人力資源等等的考量，很多時候並非要一次到位且也沒必要，像是剛起步的新創產品何時 sunset 都不知道，無需立刻放資源完善全部。但通常在穩定獲利的完善產品中，會好好處理這三者。

整體概念圖如下：

![frontend basic error system overview](/images/articles/frontend-basic-error-system/01.png)

簡言之，當錯誤發生時，在使用者端，會顯示對應的錯誤畫面; 在系統端，會記錄錯誤詳細的訊息，以及跳出給予開發人員的警告。

接著會深入談談這三個層級各自需要注意的項目。

### 畫面層級的重點項目

畫面的處理是前端本職所在，錯誤畫面需要顧及兩個最主要的層面：

1. 使用者體驗：讓使用者知道發生什麼、還可以做什麼
2. 開發者體驗：讓開發者知道怎麼查錯誤

關於要讓使用者知道發生什麼事，可以透過設計不同錯誤對應在畫面上顯示的「標題」與「訊息」;而讓使用者知道還可以怎麼做，可以透過設計操作「按鈕」讓使用者更直覺地明白還可以怎麼做。

若使用者提供當下截圖給開發者，那畫面上有什麼訊息是能夠幫助開發者查詢呢？其實只要「錯誤標題」和「錯誤訊息」是設計過的（背後對應特定的 Error Code），那就能加速查詢，但如果錯誤紀錄 Log 做得好，只要有「錯誤發生時間」即可，因為有了發生時間，就能查詢到當下錯誤的所有細節藉此更快地推測和除錯。

錯誤畫面示意圖，主要是注意資訊內容，UI 細節可忽略：

![frontend error UI 1](/images/articles/frontend-basic-error-system/02.png)

*(Error Boundary Page)*

![frontend error UI 2](/images/articles/frontend-basic-error-system/03.png)

*(Error Modal)*

可以看到其中都有 occured time，無論錯誤標題或內容是什麼，只要有錯誤發生時間，就能進一步查詢錯誤 Log。





### 記錄層級的重點項目


### 警告層級的重點項目

---

## 從實作程式層面，談前端錯誤處理與監控